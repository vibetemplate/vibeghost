<!DOCTYPE html>
<html>
<head>
    <title>åº”æ€¥è°ƒè¯•</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow: auto; }
    </style>
</head>
<body>
    <h1>ğŸš¨ VibeGhost åº”æ€¥è°ƒè¯•æ¨¡å¼</h1>
    
    <div id="status" class="status info">æ­£åœ¨åˆå§‹åŒ–...</div>
    
    <div>
        <button onclick="testBasics()">æµ‹è¯•åŸºç¡€åŠŸèƒ½</button>
        <button onclick="testPrompts()">æµ‹è¯•æç¤ºè¯</button>
        <button onclick="testInjection()">æµ‹è¯•æ³¨å…¥</button>
        <button onclick="loadReactApp()">åŠ è½½Reactåº”ç”¨</button>
        <button onclick="restartSidebar()">é‡å¯ä¾§è¾¹æ </button>
    </div>
    
    <div id="output"></div>

    <script>
        let output = document.getElementById('output');
        let status = document.getElementById('status');
        
        function log(message, type = 'info') {
            console.log(message);
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }
        
        function setStatus(message, type = 'info') {
            status.className = `status ${type}`;
            status.textContent = message;
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            testBasics();
        });
        
        async function testBasics() {
            log('ğŸ” å¼€å§‹åŸºç¡€æµ‹è¯•...', 'info');
            
            if (window.electronAPI) {
                setStatus('âœ… ElectronAPI å¯ç”¨', 'success');
                log('âœ… ElectronAPI å­˜åœ¨', 'success');
                log('ğŸ“‹ å¯ç”¨æ–¹æ³•: ' + Object.keys(window.electronAPI).join(', '), 'info');
            } else {
                setStatus('âŒ ElectronAPI ä¸å¯ç”¨', 'error');
                log('âŒ ElectronAPI ä¸å­˜åœ¨', 'error');
                return;
            }
        }
        
        async function testPrompts() {
            if (!window.electronAPI) {
                log('âŒ ElectronAPI ä¸å¯ç”¨', 'error');
                return;
            }
            
            try {
                log('ğŸ” æµ‹è¯•è·å–æç¤ºè¯...', 'info');
                const prompts = await window.electronAPI.getPrompts();
                log('âœ… è·å–æç¤ºè¯æˆåŠŸï¼Œæ•°é‡: ' + (prompts ? prompts.length : 0), 'success');
                
                if (prompts && prompts.length > 0) {
                    const pre = document.createElement('pre');
                    pre.textContent = JSON.stringify(prompts, null, 2);
                    pre.style.maxHeight = '200px';
                    output.appendChild(pre);
                }
            } catch (error) {
                log('âŒ è·å–æç¤ºè¯å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        async function testInjection() {
            if (!window.electronAPI) {
                log('âŒ ElectronAPI ä¸å¯ç”¨', 'error');
                return;
            }
            
            try {
                const testPrompt = 'æµ‹è¯•æ³¨å…¥ï¼šè¿™æ˜¯ä¸€ä¸ªç®€å•çš„æµ‹è¯•æç¤ºè¯';
                log('ğŸ” æµ‹è¯•æ³¨å…¥åŠŸèƒ½...', 'info');
                const result = await window.electronAPI.injectPrompt(testPrompt);
                
                if (result.success) {
                    log('âœ… æ³¨å…¥æµ‹è¯•æˆåŠŸ: ' + result.message, 'success');
                } else {
                    log('âŒ æ³¨å…¥æµ‹è¯•å¤±è´¥: ' + result.error, 'error');
                }
            } catch (error) {
                log('âŒ æ³¨å…¥æµ‹è¯•å¼‚å¸¸: ' + error.message, 'error');
            }
        }
        
        function loadReactApp() {
            log('ğŸ”„ å°è¯•åŠ è½½Reactåº”ç”¨...', 'info');
            // å°è¯•å¤šä¸ªå¯èƒ½çš„ç«¯å£
            const ports = ['8174', '8175', '8176', '8177'];
            let tried = 0;
            
            function tryPort(port) {
                const url = `http://localhost:${port}/sidebar.html`;
                log(`ğŸ” å°è¯•ç«¯å£ ${port}...`, 'info');
                
                fetch(url)
                    .then(response => {
                        if (response.ok) {
                            log(`âœ… æ‰¾åˆ°Reactåº”ç”¨åœ¨ç«¯å£ ${port}`, 'success');
                            window.location.href = url;
                        } else {
                            throw new Error('Not found');
                        }
                    })
                    .catch(() => {
                        tried++;
                        if (tried < ports.length) {
                            tryPort(ports[tried]);
                        } else {
                            log('âŒ æ‰€æœ‰ç«¯å£éƒ½æ— æ³•è®¿é—®Reactåº”ç”¨', 'error');
                        }
                    });
            }
            
            tryPort(ports[0]);
        }
        
        function restartSidebar() {
            log('ğŸ”„ é‡å¯ä¾§è¾¹æ ...', 'info');
            window.location.reload();
        }
        
        // é”™è¯¯å¤„ç†
        window.addEventListener('error', (e) => {
            log('ğŸ’¥ é¡µé¢é”™è¯¯: ' + e.message, 'error');
        });
    </script>
</body>
</html>